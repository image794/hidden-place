<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ù–∞–π–¥–∏ –≤—Å–µ —Å–¥–µ–ª–∞–Ω–Ω—ã–µ —Ç–æ–±–æ–π —Ñ–æ—Ç–æ üì∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #05060a;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #f5f5f5;
    }

    body {
      display: flex;
      justify-content: center;
      padding: max(10px, env(safe-area-inset-top, 0px)) 10px 16px;
    }

    .page {
      width: min(430px, 100vw);
    }

    .top-ui {
      margin-bottom: 8px;
      padding: 8px 10px 8px;
      border-radius: 18px;
      background: radial-gradient(circle at 0 0, #343b66, #181927);
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .game-title {
      font-size: 18px;
      font-weight: 600;
    }

    .game-subtitle {
      font-size: 13px;
      opacity: 0.9;
    }

    .pill {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 13px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.45);
      white-space: nowrap;
    }

    .pill-btn {
      cursor: pointer;
      outline: none;
    }

    .pill-btn:active {
      transform: scale(0.97);
    }

    .counter-pill {
      font-weight: 600;
    }

    /* –†–∞–º–∫–∞ —Å —Ñ–æ–Ω–æ–º –∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
    .image-frame {
      position: relative;
      width: 100%;
      aspect-ratio: 9 / 14; /* –ß–£–¢–¨ –ù–ò–ñ–ï, –ß–ï–ú 9/16 ‚Äî –º–µ–Ω—å—à–µ –≤—ã—Å–æ—Ç–∞ */
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.75);
      background: #000;
    }

    /* –§–æ–Ω: —Ç–≤–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ */
    .base-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.96);
      transition: filter 0.25s ease;
    }

    /* –°–ª–æ–π —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ */
    .items-layer {
      position: absolute;
      inset: 0;
      pointer-events: none; /* –∫–ª–∏–∫–∏ —Ç–æ–ª—å–∫–æ –ø–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º, –Ω–µ –ø–æ —Å–ª–æ—é */
    }

    .item {
      position: absolute;
      pointer-events: auto;
      cursor: pointer;
      user-select: none;
      -webkit-user-drag: none;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1),
                  0 10px 25px rgba(0, 0, 0, 0.65);
      transform: translate(-50%, -50%) rotate(var(--initial-rotation, 0deg));
      transition:
        transform 0.18s ease,
        opacity 0.3s ease,
        box-shadow 0.18s ease;
      background: rgba(0, 0, 0, 0.6);
    }

    .item-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .item:hover {
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.45),
                  0 12px 30px rgba(0, 0, 0, 0.9);
      transform: translate(-50%, -50%) scale(1.03) rotate(var(--initial-rotation, 0deg));
    }

    .item.found {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.7) rotate(var(--initial-rotation, 0deg));
      box-shadow: none;
      pointer-events: none;
    }

    .page.game-complete .base-image {
      filter: brightness(1.05);
    }

    .status-text {
      font-size: 13px;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="page" id="page">
    <header class="top-ui">
      <div class="top-row">
        <div class="game-title">–ù–∞–π–¥–∏ –≤—Å–µ —á—Ç–æ —Å–∫—Ä—ã—Ç–æ üîç</div>
        <button class="pill pill-btn" id="musicToggle"> –ü–æ–¥–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ üéµ</button>
      </div>
      <div class="top-row">
        <div class="game-subtitle">
          –ù–∞–∂–∏–º–∞–π –Ω–∞ —Å–≤–æ–∏ —Ñ–æ—Ç–æ, —á—Ç–æ–±—ã –æ–Ω–∏ –∏—Å—á–µ–∑–∞–ª–∏.
        </div>
        <div class="pill counter-pill" id="counter">–ù–∞–π–¥–µ–Ω–æ 0 –∏–∑ 40</div>
      </div>
      <!-- –ü–ï–†–ï–ù–Å–° –í–ï–°–¨ –ù–ò–ñ–ù–ò–ô –¢–ï–ö–°–¢ –°–Æ–î–ê -->
      <div class="status-text" id="statusText">
        –ù–∞–π–¥–∏ 36 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ñ–æ—Ç–æ –û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å üôÇ
      </div>
    </header>

    <div class="image-frame">
      <!-- —Ç–≤–æ–π —Ñ–æ–Ω: –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏ background.jpg –Ω–∞ —Å–≤–æ–π —Ñ–∞–π–ª -->
      <img src="bg1.jpg" alt="–§–æ–Ω" class="base-image" />

      <!-- —Å—é–¥–∞ JS –¥–æ–±–∞–≤–∏—Ç –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã -->
      <div class="items-layer" id="itemsLayer"></div>
    </div>
  </div>

  <script>
    // === –ù–ê–°–¢–†–û–ô–ö–ò ===
    const GOOD_COUNT = 36;  // —Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
    const BAD_COUNT = 60;   // —Å–∫–æ–ª—å–∫–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö
    const TOTAL_ITEMS = GOOD_COUNT + BAD_COUNT;

    // —Ä–∞–∑–º–µ—Ä—ã (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç —à–∏—Ä–∏–Ω—ã —Ä–∞–º–∫–∏):
    const BASE_WIDTH_PERCENT = 20;      // –±–∞–∑–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞
    const SIZE_VARIATION = 0.2;         // ¬±20%
    const ROTATED_COUNT = 37;           // —Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫ —á—É—Ç—å –ø–æ–≤–µ—Ä–Ω—É—Ç—å
    const COLS = 8;                     // "—Å–µ—Ç–∫–∞" –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    const ROWS = 13;                    // –≤–º–µ—Å—Ç–µ –¥–∞—ë—Ç 96 —è—á–µ–µ–∫ (> 123 –∫–∞—Ä—Ç–∏–Ω–æ–∫)
    const JITTER = 2;                   // —Ä–∞–∑–±—Ä–æ—Å –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ —è—á–µ–π–∫–∏ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)

    const page = document.getElementById('page');
    const itemsLayer = document.getElementById('itemsLayer');
    const counterEl = document.getElementById('counter');
    const statusTextEl = document.getElementById('statusText');
    const musicToggle = document.getElementById('musicToggle');

    let foundGood = 0;

    // === –ú–£–ó–´–ö–ê (–ø–æ –∂–µ–ª–∞–Ω–∏—é) ===
    let audio;
    let musicOn = false;
    try {
      audio = new Audio('music.mp3'); // –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç ‚Äì –ø—Ä–æ—Å—Ç–æ –Ω–µ –±—É–¥–µ—Ç –∏–≥—Ä–∞—Ç—å
      audio.loop = true;
    } catch (e) {
      audio = null;
    }

    musicToggle.addEventListener('click', () => {
      if (!audio) return;
      musicOn = !musicOn;
      if (musicOn) {
        audio.play().catch(() => {});
        musicToggle.textContent = '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–∫–ª üé∂';
      } else {
        audio.pause();
        musicToggle.textContent = '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤—ã–∫–ª üéµ';
      }
    });

    // === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===

    function updateCounter() {
      counterEl.textContent = `–ù–∞–π–¥–µ–Ω–æ ${foundGood} –∏–∑ ${GOOD_COUNT}`;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π —è—á–µ–µ–∫
    function makeGridPositions(cols, rows) {
      const cells = [];
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const x = ((c + 0.5) / cols) * 100;
          const y = ((r + 0.5) / rows) * 100;
          cells.push({ x, y });
        }
      }
      return shuffle(cells);
    }

    // === –°–û–ó–î–ê–Å–ú –°–ü–ò–°–û–ö –ü–†–ï–î–ú–ï–¢–û–í (–¢–û–õ–¨–ö–û –ò–ú–ï–ù–ê –§–ê–ô–õ–û–í) ===
    const itemsData = [];

    for (let i = 1; i <= GOOD_COUNT; i++) {
      itemsData.push({
        src: `good${i}.jpg`,
        type: 'good',
        label: `–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ ${i}`
      });
    }

    for (let i = 1; i <= BAD_COUNT; i++) {
      itemsData.push({
        src: `bad${i}.jpg`,
        type: 'bad',
        label: `–ó–∞—â–∏—â–µ–Ω–æ –∞–≤—Ç–æ—Ä—Å–∫–∏–º –ø—Ä–∞–≤–æ–º, –Ω–µ —Ç–≤–æ–µ ${i}`
      });
    }

    // –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–µ —à–ª–∏ –ø–æ–¥—Ä—è–¥
    shuffle(itemsData);

    // –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —á—É—Ç—å –ø–æ–≤–µ—Ä–Ω—É—Ç—ã
    const rotatedIndexes = new Set();
    while (rotatedIndexes.size < Math.min(ROTATED_COUNT, itemsData.length)) {
      rotatedIndexes.add(Math.floor(Math.random() * itemsData.length));
    }

    const gridPositions = makeGridPositions(COLS, ROWS);

    // === –°–û–ó–î–ê–Å–ú –ö–ê–†–¢–ò–ù–ö–ò –í DOM ===
    itemsData.forEach((item, index) => {
      const cell = gridPositions[index % gridPositions.length];

      const wrapper = document.createElement('div');
      wrapper.className = `item ${item.type}`;
      wrapper.dataset.type = item.type;

      // —Å–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä ¬±20%
      const delta = (Math.random() * 2 - 1) * SIZE_VARIATION; // –æ—Ç -0.2 –¥–æ +0.2
      const width = BASE_WIDTH_PERCENT * (1 + delta);

      // –Ω–µ–±–æ–ª—å—à–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ —è—á–µ–π–∫–∏
      const offsetX = (Math.random() * 2 - 1) * JITTER;
      const offsetY = (Math.random() * 2 - 1) * JITTER;

      const x = cell.x + offsetX;
      const y = cell.y + offsetY;

      wrapper.style.width = `${width}%`;
      wrapper.style.left = `${x}%`;
      wrapper.style.top = `${y}%`;

      // –ø–æ–≤–æ—Ä–æ—Ç —á–∞—Å—Ç–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫
      let rotation = 0;
      if (rotatedIndexes.has(index)) {
        rotation = (Math.random() * 30 - 15).toFixed(1); // –æ—Ç -15¬∞ –¥–æ +15¬∞
      }
      wrapper.style.setProperty('--initial-rotation', `${rotation}deg`);

      const img = document.createElement('img');
      img.src = item.src;
      img.alt = item.label;
      img.className = 'item-img';

      wrapper.appendChild(img);
      itemsLayer.appendChild(wrapper);
    });

    // === –õ–û–ì–ò–ö–ê –ö–õ–ò–ö–û–í ===
    updateCounter();

    itemsLayer.addEventListener('click', (event) => {
      const target = event.target.closest('.item');
      if (!target) return;

      const type = target.dataset.type;

      if (type === 'good') {
        if (target.classList.contains('found')) return;
        target.classList.add('found');
        foundGood++;
        updateCounter();

        if (foundGood >= GOOD_COUNT) {
          statusTextEl.textContent = '–ë—Ä–∞–≤–æ! –¢—ã –Ω–∞—à–ª–∞ –≤—Å–µ —Å–≤–æ–∏ —Ñ–æ—Ç–æ ‚ú®';
          page.classList.add('game-complete');

          // —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
          document.querySelectorAll('.item').forEach((it) => {
            if (!it.classList.contains('found')) {
              it.classList.add('found');
            }
          });
        } else {
          statusTextEl.textContent = '–£—É—Ñ—Ñ—Ñ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –∏—Å–∫–∞—Ç—å —Å–≤–æ–∏ —Ñ–æ—Ç–æ‚Ä¶';
        }
      } else {
        // –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç ‚Äî –Ω–µ —É–±–∏—Ä–∞–µ–º, –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç
        statusTextEl.textContent = '–≠—Ç–æ –Ω–µ —Ç–æ —Ñ–æ—Ç–æ üòè –ò—â–∏ –¥—Ä—É–≥–∏–µ.';
      }
    });
  </script>
</body>
</html>
