<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ù–∞–π–¥–∏ —Å–ø—Ä—è—Ç–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      background: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      color: #f5f5f5;
    }

    .game-wrapper {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #000;
      touch-action: manipulation;
    }

    .base-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.95);
      transition: filter 0.3s ease;
      z-index: 1;
    }

    .items-layer {
      position: absolute;
      inset: 0;
      z-index: 5;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }

    .item {
      position: absolute;
      pointer-events: auto;
      cursor: pointer;
      user-select: none;
      -webkit-user-drag: none;
      /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä: –æ—Ç —à–∏—Ä–∏–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
      width: 14%;
      max-width: 120px;
      border-radius: 22px;
      background: rgba(10, 12, 20, 0.8);
      border: 2px solid rgba(255, 255, 255, 0.18);
      box-shadow:
        0 0 0 1px rgba(0, 0, 0, 0.5),
        0 12px 25px rgba(0, 0, 0, 0.6);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;

      --scale: 1;
      transform: scale(var(--scale));
      transition:
        opacity 0.35s ease,
        transform 0.35s ease,
        box-shadow 0.2s ease;
    }

    .item img {
      width: 80%;
      height: 80%;
      object-fit: cover;
    }

    .item:hover {
      transform: scale(calc(var(--scale) * 1.05));
      box-shadow:
        0 0 0 1px rgba(255, 255, 255, 0.3),
        0 14px 30px rgba(0, 0, 0, 0.9);
    }

    .item.found {
      opacity: 0;
      transform: scale(calc(var(--scale) * 0.55));
      pointer-events: none;
      box-shadow: none;
    }

    .item.bad.shake {
      animation: shake 0.25s linear;
    }

    @keyframes shake {
      0%   { transform: translateX(0) scale(var(--scale)); }
      25%  { transform: translateX(-4px) scale(var(--scale)); }
      50%  { transform: translateX(4px) scale(var(--scale)); }
      75%  { transform: translateX(-2px) scale(var(--scale)); }
      100% { transform: translateX(0) scale(var(--scale)); }
    }

    .top-bar {
      position: absolute;
      left: env(safe-area-inset-left, 8px);
      right: env(safe-area-inset-right, 8px);
      top: env(safe-area-inset-top, 8px);
      z-index: 20;
      padding: 6px 10px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(18, 21, 40, 0.96), rgba(34, 40, 70, 0.96));
      border: 1px solid rgba(255, 255, 255, 0.16);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 13px;
    }

    .top-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .top-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .top-hint {
      font-size: 12px;
      opacity: 0.9;
    }

    .music-btn {
      align-self: flex-start;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      background: rgba(0, 0, 0, 0.25);
      color: #f5f5f5;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .music-btn.active {
      background: rgba(30, 199, 120, 0.25);
      border-color: rgba(30, 199, 120, 0.9);
    }

    .counter-pill {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      background: rgba(0, 0, 0, 0.3);
      white-space: nowrap;
    }

    .final-message {
      position: absolute;
      left: 50%;
      bottom: env(safe-area-inset-bottom, 14px);
      transform: translateX(-50%);
      z-index: 20;
      padding: 10px 14px;
      max-width: calc(100% - 32px);
      border-radius: 14px;
      background: rgba(30, 199, 120, 0.15);
      border: 1px solid rgba(30, 199, 120, 0.7);
      font-size: 13px;
      text-align: center;
      display: none;
    }

    .game-complete .final-message {
      display: block;
    }

    .game-complete .items-layer {
      opacity: 0;
      pointer-events: none;
    }

    .game-complete .base-image {
      filter: brightness(1.05);
    }

    @media (min-width: 900px) {
      .game-wrapper {
        width: 430px;
        height: 932px;
        border-radius: 24px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.85);
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper" id="game">
    <img src="background.jpg" alt="–§–æ–Ω" class="base-image" />

    <div class="items-layer" id="itemsLayer">
      <!-- –ö–∞—Ä—Ç–æ—á–∫–∏-–ø—Ä–µ–¥–º–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
    </div>

    <div class="top-bar">
      <div class="top-left">
        <button class="music-btn" id="musicToggle">–í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É üéµ</button>
        <div class="top-hint">–ù–∞–∂–∏–º–∞–π –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –∏—Å—á–µ–∑–∞–ª–∏.</div>
      </div>
      <div class="counter-pill" id="counter">–ù–∞–π–¥–µ–Ω–æ 0 –∏–∑ 18</div>
    </div>

    <div class="final-message" id="finalMessage">
      –ë—Ä–∞–≤–æ! üéâ –¢—ã –Ω–∞—à–ª–∞ –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã. –ö–∞—Ä—Ç–∏–Ω–∫–∞ —Ç–µ–ø–µ—Ä—å —á–∏—Å—Ç–∞—è ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é.
    </div>

    <audio id="bgMusic" src="music.mp3" loop></audio>
  </div>

  <script>
    // ===== –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´ =====
    const GOOD_COUNT = 18;
    const TOTAL_ITEMS = 100; // 18 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö + 82 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö

    // –°–Æ–î–ê –í–ü–ò–®–ò –ò–ú–ï–ù–ê –°–í–û–ò–• 18 –ü–†–ê–í–ò–õ–¨–ù–´–• –ö–ê–†–¢–ò–ù–û–ö (—Ñ–∞–π–ª—ã –ª–µ–∂–∞—Ç —Ä—è–¥–æ–º —Å index.html)
    const goodImages = [
      "good1.jpg",
      "good2.jpg",
      "good3.jpg",
      "good4.jpg",
      "good5.jpg",
      "good6.jpg",
      "good7.jpg",
      "good8.jpg",
      "good9.jpg",
      "good10.jpg",
      "good11.jpg",
      "good12.jpg",
      "good13.jpg",
      "good14.jpg",
      "good15.jpg",
      "good16.jpg",
      "good17.jpg",
      "good18.jpg"
    ];

    // –ö–∞—Ä—Ç–∏–Ω–∫–∞-–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–º–æ–∂–µ—à—å –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ —Å–≤–æ—é)
    const badPlaceholder = "https://i.imgur.com/1Yc5Z6v.png";

    const game = document.getElementById("game");
    const itemsLayer = document.getElementById("itemsLayer");
    const counterEl = document.getElementById("counter");
    const finalMessage = document.getElementById("finalMessage");
    const musicToggle = document.getElementById("musicToggle");
    const bgMusic = document.getElementById("bgMusic");

    let foundGood = 0;
    let musicOn = false;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function updateCounter() {
      counterEl.textContent = `–ù–∞–π–¥–µ–Ω–æ ${foundGood} –∏–∑ ${GOOD_COUNT}`;
    }

    function createItems() {
      const positions = [];

      const COLS = 10;
      const ROWS = 10;

      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          positions.push({ r, c });
        }
      }

      shuffle(positions);

      const flags = Array(TOTAL_ITEMS)
        .fill(false)
        .map((_, i) => i < GOOD_COUNT); // –ø–µ—Ä–≤—ã–µ 18 ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
      shuffle(flags); // –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –±—ã–ª–∏ –Ω–µ –ø–æ–¥—Ä—è–¥

      for (let i = 0; i < TOTAL_ITEMS; i++) {
        const isGood = flags[i];
        const pos = positions[i];

        const wrapper = document.createElement("div");
        wrapper.className = "item " + (isGood ? "good" : "bad");
        wrapper.dataset.correct = isGood ? "1" : "0";

        const img = document.createElement("img");
        if (isGood) {
          const idx = i % goodImages.length;
          img.src = goodImages[idx];
        } else {
          img.src = badPlaceholder;
        }
        wrapper.appendChild(img);

        // –ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö —Å –Ω–µ–±–æ–ª—å—à–∏–º —Ä–∞–Ω–¥–æ–º–Ω—ã–º —Å–º–µ—â–µ–Ω–∏–µ–º
        const cellWidth = 100 / COLS;
        const cellHeight = 100 / ROWS;

        const jitterX = (Math.random() - 0.5) * 12; // +/- %
        const jitterY = (Math.random() - 0.5) * 12;

        const left = (pos.c + 0.5) * cellWidth + jitterX;
        const top = (pos.r + 0.5) * cellHeight + jitterY;

        wrapper.style.left = left + "%";
        wrapper.style.top = top + "%";
        wrapper.style.transformOrigin = "50% 50%";

        // –ª—ë–≥–∫–∏–π —Ä–∞–∑–±—Ä–æ—Å –ø–æ —Ä–∞–∑–º–µ—Ä—É
        const scale = 0.9 + Math.random() * 0.4; // 0.9‚Äì1.3
        wrapper.style.setProperty("--scale", scale.toString());

        itemsLayer.appendChild(wrapper);
      }
    }

    function handleItemClick(e) {
      const target = e.target.closest(".item");
      if (!target) return;

      const isGood = target.dataset.correct === "1";

      if (isGood) {
        if (target.classList.contains("found")) return;
        target.classList.add("found");
        foundGood++;
        updateCounter();

        if (foundGood === GOOD_COUNT) {
          // –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–π–¥–µ–Ω—ã
          game.classList.add("game-complete");
        }
      } else {
        target.classList.remove("shake");
        void target.offsetWidth; // –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é
        target.classList.add("shake");
      }
    }

    function setupMusic() {
      musicToggle.addEventListener("click", () => {
        if (!bgMusic.src) return;

        if (musicOn) {
          bgMusic.pause();
          musicOn = false;
          musicToggle.classList.remove("active");
          musicToggle.textContent = "–í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É üéµ";
        } else {
          bgMusic
            .play()
            .then(() => {
              musicOn = true;
              musicToggle.classList.add("active");
              musicToggle.textContent = "–í—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É üîá";
            })
            .catch(() => {
              // –º–æ–±–∏–ª—å–Ω—ã–π Safari –º–æ–∂–µ—Ç –Ω–µ –¥–∞—Ç—å –∞–≤—Ç–æ-–ø–ª–µ–π –±–µ–∑ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è ‚Äî
              // –Ω–æ –∫–Ω–æ–ø–∫–∞ —É–∂–µ —è–≤–ª—è–µ—Ç—Å—è –∫–ª–∏–∫–æ–º, —Ç–∞–∫ —á—Ç–æ –æ–±—ã—á–Ω–æ –≤—Å—ë –Ω–æ—Ä–º
            });
        }
      });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    createItems();
    updateCounter();
    itemsLayer.addEventListener("click", handleItemClick);
    setupMusic();
  </script>
</body>
</html>
